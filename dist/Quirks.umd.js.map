{"version":3,"file":null,"sources":["../src/quirks/Quirk.js","../src/QuirksManager.js"],"sourcesContent":["/**\n * Quirk\n *\n * Copyright ©2017 Dana Basken <dbasken@gmail.com>\n *\n */\nclass Quirk {\n\n  constructor() {\n    this._private('_animated', false);\n    this._private('_element', null);\n    this._private('_observer', null);\n  }\n\n  get animated() {\n    return this._animated;\n  }\n\n  set animated(value) {\n    if (this._animated !== value) {\n      this._animated = value;\n      this._animate();\n    }\n  }\n\n  get element() {\n    return this._element;\n  }\n\n  set element(value) {\n    this._element = value;\n    this._observe();\n  }\n\n  start() {\n    this.onStart();\n    this._animate();\n  }\n\n  update(timestamp) {\n    this.onUpdate(timestamp);\n    this._animate();\n  }\n\n  add(element) {\n    this.element = element;\n    this._asyncCall('onAdd', element);\n  }\n\n  remove(element) {\n    this._animated = false;\n    this._asyncCall('onRemove', element);\n  }\n\n  change(element, mutation) {\n    this._asyncCall('onChange', element, mutation);\n  }\n\n  onStart() {\n  }\n\n  onUpdate(timestamp) {\n  }\n\n  onAdd(element) {\n  }\n\n  onRemove(element) {\n  }\n\n  onChange(element, mutation) {\n  }\n\n  _animate() {\n    if (this._animated) {\n      window.requestAnimationFrame(this.update.bind(this));\n    }\n  }\n\n  _observe() {\n    if (this._observer) {\n      this._observer.disconnect();\n      this._observer = null;\n    }\n    if (this._element) {\n      this._observer = new MutationObserver(function(mutations) {\n        mutations.forEach(function(mutation) {\n\n            var quirks = [];\n            if (mutation.type === 'characterData') {\n              quirks = quirks.concat(this._findMutatedQuirks(mutation.target));\n              quirks = quirks.concat(this._findMutatedQuirks(mutation.target.parentElement));\n            }\n            if (mutation.type === 'attributes') {\n              quirks = quirks.concat(this._findMutatedQuirks(mutation.target));\n            }\n            quirks.forEach(function(quirk) {\n              quirk.change(this._element, mutation);\n            }.bind(this));\n/*\n            mutation.removedNodes.forEach(function(node) {\n              if (node.quirks) {\n                node.quirks.forEach(function(quirk) {\n                  quirk.remove(node);\n                }.bind(this));\n              }\n            }.bind(this));\n*/\n\n        }.bind(this));\n      }.bind(this));\n      var config = {attributes: true, characterData: true, subtree: true};\n      this._observer.observe(this._element, config);\n    }\n  }\n\n  _findMutatedQuirks(element) {\n    var results = [];\n    if (element.quirks) {\n      results = element.quirks;\n    }\n    return results;\n  }\n\n  _asyncCall(method, ...args) {\n    if (typeof this[method] === 'function') {\n      setTimeout(function() {\n        this[method].apply(this, args);\n      }.bind(this), 0);\n    } else {\n      throw new Error('method does not exist: ' + method);\n    }\n  }\n\n  _private(name, value) {\n    Object.defineProperty(this, name, {configurable: false, enumerable: false, value: value, writable: true});\n  }\n\n}\n\nexport default Quirk;\n","/**\n * QuirksManager\n *\n * Copyright ©2017 Dana Basken <dbasken@gmail.com>\n *\n */\nimport Quirk from './quirks/Quirk.js';\n\nclass QuirksManager {\n\n  constructor() {\n    this._observe();\n  }\n\n  add(selector, quirk) {\n    if (selector instanceof HTMLElement) {\n      this._add(selector, quirk);\n    } else {\n      // TODO: fix this, Quirk is currently only aware of being owned by 1 element\n      var elements = document.querySelectorAll(selector);\n      elements.forEach(function(element) {\n        this._add(element, quirk);\n      }.bind(this));\n    }\n  }\n\n  start() {\n    var elements = document.querySelectorAll('.quirk-enabled');\n    elements.forEach(function(element) {\n      element.quirks.forEach(function(quirk) {\n        quirk.start();\n      });\n    });\n  }\n\n  _add(element, quirk) {\n    if (quirk instanceof Quirk) {\n      if (!element.quirks) {\n        element.quirks = [];\n      }\n      element.quirks.push(quirk);\n      quirk.element = element;\n      element.classList.add('quirk-enabled');\n    } else {\n      throw new Error('must be instance of Quirk');\n    }\n  }\n\n  _observe() {\n    var observer = new MutationObserver(function(mutations) {\n      mutations.forEach(function(mutation) {\n        if (mutation.type === 'childList') {\n          if (mutation.removedNodes) {\n            mutation.removedNodes.forEach(function(node) {\n              if (node.quirks) {\n                node.quirks.forEach(function(quirk) {\n                  quirk.remove(node);\n                }.bind(this));\n              }\n            }.bind(this));\n          }\n          if (mutation.addedNodes) {\n            mutation.addedNodes.forEach(function(node) {\n              if (node.quirks) {\n                node.quirks.forEach(function(quirk) {\n                  quirk.add(node);\n                }.bind(this));\n              }\n            }.bind(this));\n          }\n        }\n      }.bind(this));\n    }.bind(this));\n    var config = {childList: true, subtree: true};\n    observer.observe(document, config);\n  }\n\n}\n\nexport {QuirksManager, Quirk};\n"],"names":["Quirk","_private","onStart","_animate","timestamp","onUpdate","element","_asyncCall","_animated","mutation","requestAnimationFrame","update","bind","_observer","disconnect","_element","MutationObserver","mutations","forEach","quirks","type","concat","_findMutatedQuirks","target","parentElement","quirk","change","config","attributes","characterData","subtree","observe","results","method","args","apply","Error","name","value","defineProperty","configurable","enumerable","writable","_observe","QuirksManager","selector","HTMLElement","_add","elements","document","querySelectorAll","start","push","classList","add","observer","removedNodes","node","remove","addedNodes","childList"],"mappings":"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"}